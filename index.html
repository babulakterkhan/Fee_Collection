<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü - ‡¶´‡¶ø ‡¶Ü‡¶¶‡¶æ‡ßü ‡¶ì ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Hind Siliguri', Arial, sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        /* Storage Status */
        .storage-status { position: fixed; top: 20px; left: 20px; padding: 10px 20px; border-radius: 40px; font-size: 14px; font-weight: 600; color: white; z-index: 9999; box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #2e7d32, #1b5e20); border: 1px solid rgba(255,255,255,0.2); transition: all 0.3s; }
        .storage-status.error { background: linear-gradient(135deg, #c62828, #8e0000); }

        .school-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #1a73e8; padding-bottom: 15px; position: relative; background: linear-gradient(to right, #f8f9fa, #ffffff); }
        #schoolLogoImg { max-width: 100px; max-height: 100px; display: none; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #headerName { margin: 0; color: #1a73e8; font-size: clamp(24px, 5vw, 32px); font-weight: 700; }
        #headerAddress { margin: 5px 0 0; font-size: 15px; color: #666; }
        .header-buttons { position: absolute; right: 20px; top: 20px; display: flex; gap: 10px; }
        .icon-btn { background: #546e7a; color: white; border: none; padding: 8px 18px; border-radius: 30px; cursor: pointer; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: all 0.3s; }
        .icon-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .school-switcher { background: #4a90e2; }
        .school-id-badge { margin-top: 8px; font-size: 14px; color: #1a73e8; background: #e8f0fe; padding: 5px 15px; border-radius: 30px; display: inline-block; font-weight: 500; }

        .tab-container { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 25px; gap: 5px; }
        .tab-btn { padding: 12px 25px; background: none; border: none; cursor: pointer; font-size: 16px; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s; border-radius: 8px 8px 0 0; }
        .tab-btn.active { color: #1a73e8; border-bottom: 3px solid #1a73e8; background: rgba(26, 115, 232, 0.05); }
        .tab-btn:hover { background: #f0f2f5; color: #1a73e8; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .settings-panel { display: none; background: #fff3e0; border: 2px solid #ffb74d; padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2); animation: slideDown 0.3s; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        .input-box, .search-panel { background: #e3f2fd; padding: 25px; border-radius: 12px; margin-bottom: 25px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; border: 1px solid #90caf9; }
        .search-panel { background: #f1f8e9; border: 1px solid #a5d6a7; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
        .full-row { grid-column: 1 / -1; }
        .year-month-box { background: #fff; padding: 20px; border: 2px solid #bbdefb; border-radius: 10px; margin-top: 10px; }
        .month-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
        .month-item { font-size: 14px; display: flex; align-items: center; gap: 8px; cursor: pointer; background: #f8f9fa; padding: 8px 12px; border-radius: 25px; border: 1px solid #dee2e6; transition: all 0.2s; }
        .month-item:hover { background: #e3f2fd; border-color: #1a73e8; }
        .fee-selection { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; background: white; padding: 20px; border-radius: 10px; border: 2px solid #bbdefb; }
        
        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid #dee2e6; }
        table { width: 100%; border-collapse: collapse; background: white; font-size: 14px; }
        th, td { border: 1px solid #dee2e6; padding: 12px; text-align: center; }
        th { background: linear-gradient(135deg, #1a73e8, #0d47a1); color: white; font-weight: 600; position: sticky; top: 0; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        tr:hover { background-color: #e3f2fd; }
        .total-row { background: linear-gradient(135deg, #263238, #37474f) !important; color: #ffeb3b !important; font-weight: bold; font-size: 16px; }
        
        .btn { padding: 10px 18px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; color: white; font-size: 14px; transition: all 0.3s; display: inline-flex; align-items: center; gap: 5px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(0); }
        .btn-save { background: linear-gradient(135deg, #2e7d32, #1b5e20); width: 100%; padding: 14px; font-size: 16px; margin-top: 15px; font-weight: 700; }
        .btn-edit { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .btn-delete { background: linear-gradient(135deg, #dc3545, #c82333); }
        .btn-print { background: linear-gradient(135deg, #17a2b8, #138496); }
        .btn-backup { background: linear-gradient(135deg, #6c757d, #495057); }
        
        input, select, textarea { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; width: 100%; box-sizing: border-box; font-size: 14px; transition: all 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: #1a73e8; outline: none; box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1); }
        input:hover, select:hover { border-color: #90caf9; }
        
        #studentNameDisplay { font-weight: 600; color: #1565c0; background: #fff; padding: 12px; border: 2px solid #90caf9; border-radius: 8px; min-height: 24px; display: flex; align-items: center; }
        .student-list-container { max-height: 300px; overflow-y: auto; border: 2px solid #e0e0e0; border-radius: 8px; margin-top: 15px; }
        .student-list-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .student-list-table th, .student-list-table td { border: 1px solid #dee2e6; padding: 8px; text-align: left; }
        .student-list-table th { background: linear-gradient(135deg, #546e7a, #37474f); color: white; position: sticky; top: 0; }
        .edit-mode { border: 3px solid #ff9800 !important; background: #fff3e0; box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.2); }

        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .card { padding: 25px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); transition: all 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .card-income { background: linear-gradient(135deg, #2e7d32, #1b5e20); }
        .card-expense { background: linear-gradient(135deg, #c62828, #8e0000); }
        .card-balance { background: linear-gradient(135deg, #1565c0, #0d47a1); }
        .card h2 { margin: 10px 0 0; font-size: 32px; font-weight: 700; }
        .card p { margin: 0; font-size: 16px; opacity: 0.9; font-weight: 500; }
        .ie-form { background: #e8f5e9; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end; }

        @media print { .no-print { display: none !important; } body { background: white; padding: 0; } .container { box-shadow: none; padding: 10px; } table { font-size: 12px; } }
        @media (max-width: 768px) { .container { padding: 15px; } .tab-btn { padding: 8px 12px; font-size: 14px; } .header-buttons { position: static; margin-top: 10px; justify-content: center; } .school-header { padding-top: 10px; } .storage-status { top: 10px; left: 10px; font-size: 12px; padding: 8px 15px; } }

        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 5px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #1a73e8, #0d47a1); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, #0d47a1, #1a73e8); }

        .password-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 10000; backdrop-filter: blur(5px); }
        .password-box { background: white; padding: 40px; border-radius: 20px; width: 400px; max-width: 90%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: popIn 0.5s; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .password-box h2 { color: #1a73e8; margin-bottom: 20px; font-size: 28px; }
        .password-box input { width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #e0e0e0; border-radius: 50px; font-size: 18px; text-align: center; }
        .password-box input:focus { border-color: #1a73e8; }
        .password-box button { background: linear-gradient(135deg, #1a73e8, #0d47a1); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s; }
        .password-box button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(26, 115, 232, 0.3); }
        .password-box .error { color: #c62828; margin-top: 10px; font-size: 14px; display: none; }

        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: bold; z-index: 10001; animation: slideIn 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .notification.success { background: linear-gradient(135deg, #2e7d32, #1b5e20); }
        .notification.error { background: linear-gradient(135deg, #c62828, #8e0000); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

<!-- ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü -->
<div id="passwordOverlay" class="password-overlay">
    <div class="password-box">
        <h2>üîê ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
        <p style="color:#666; margin-bottom:10px;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®</p>
        <input type="password" id="passwordInput" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" autofocus>
        <button onclick="checkPassword()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="passwordError" class="error">‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
    </div>
</div>

<!-- Storage Status Indicator -->
<div id="storageStatus" class="storage-status">
    <span>üíæ</span> <span id="statusText">LocalStorage ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§</span>
</div>

<!-- ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶≠ -->
<div id="notification" class="notification" style="display: none;"></div>

<div class="container" style="display: none;">
    <div class="school-header">
        <div class="header-buttons no-print">
            <button onclick="switchSchool()" class="icon-btn school-switcher"><span>üîÑ</span> ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
            <button onclick="openSettings()" class="icon-btn"><span>‚öôÔ∏è</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
        </div>
        <img id="schoolLogoImg" src="" alt="Logo">
        <h1 id="headerName">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h1>
        <p id="headerAddress">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...</p>
        <div class="school-id-badge"><span>üè´</span> ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø: <span id="schoolIdDisplay">demo_school</span></div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-container no-print">
        <button class="tab-btn active" onclick="switchTab('feeTab')">üí∞ ‡¶´‡¶ø ‡¶Ü‡¶¶‡¶æ‡ßü ‡¶ì ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ</button>
        <button class="tab-btn" onclick="switchTab('accountsTab')">üìä ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ñ‡¶æ‡¶§‡¶æ (‡¶Ü‡ßü-‡¶¨‡ßç‡¶Ø‡ßü)</button>
    </div>

    <!-- Settings Panel -->
    <div id="settingsArea" class="settings-panel no-print">
        <h3 style="margin-bottom: 15px; color: #f57c00;">üõ† ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ì ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™</h3>
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-bottom:15px;">
            <input type="text" id="setSchoolName" placeholder="‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
            <input type="text" id="setSchoolAddr" placeholder="‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
            <input type="text" id="setSchoolMob" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
            <div><label style="font-size:12px; color:#666;">‡¶≤‡ßã‡¶ó‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶°:</label><input type="file" id="logoUpload" accept="image/*" onchange="previewLogo(this)"></div>
        </div>
        <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: flex-end;">
            <button onclick="changePassword()" class="btn" style="background: #17a2b8;">üîë ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</button>
        </div>
        <hr style="border:1px dashed #ffb74d; margin:20px 0;">
        
        <h3 style="color:#d32f2f; margin-bottom:15px;">üë®‚Äçüéì ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</h3>
        <div style="background:#fff; padding:20px; border-radius:8px;">
            <div id="studentFormBox" style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px;">
                <h4 style="margin:0 0 15px; font-size:16px; color:#37474f;">‡¶è‡¶ï‡¶ï ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ø‡ßã‡¶ó/‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</h4>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:10px; margin-bottom:10px;">
                    <input type="text" id="newStName" placeholder="‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                    <input type="text" id="newStClass" placeholder="‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø">
                    <input type="number" id="newStRoll" placeholder="‡¶∞‡ßã‡¶≤">
                </div>
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:10px;">
                    <input type="text" id="newStSection" placeholder="‡¶∂‡¶æ‡¶ñ‡¶æ">
                    <input type="text" id="newStGroup" placeholder="‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó">
                    <input type="text" id="newStSession" placeholder="‡¶∏‡ßá‡¶∂‡¶®">
                    <button id="addStudentBtn" onclick="saveStudentData()" class="btn" style="background:#ff9800; width:100%;">‚ûï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
            <div style="display:grid; grid-template-columns:1fr auto; gap:15px; align-items: center; margin-bottom:15px;">
                <div><label style="font-size:12px; color:#666;">CSV: ‡¶®‡¶æ‡¶Æ, ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø, ‡¶∞‡ßã‡¶≤, ‡¶∂‡¶æ‡¶ñ‡¶æ, ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó, ‡¶∏‡ßá‡¶∂‡¶®</label><input type="file" id="csvStudentFile" accept=".csv" style="padding:8px;"></div>
                <button onclick="uploadStudentCSV()" class="btn" style="background:#009688;">üì§ CSV ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
            </div>
            <div class="student-list-container">
                <table class="student-list-table"><thead><tr><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</th><th>‡¶∞‡ßã‡¶≤</th><th>‡¶∂‡¶æ‡¶ñ‡¶æ</th><th>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th><th>‡¶∏‡ßá‡¶∂‡¶®</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="studentListPreviewBody"></tbody></table>
            </div>
        </div>
        <hr style="border:1px dashed #ffb74d; margin:20px 0;">
        <div style="display:flex; gap:15px; flex-wrap: wrap;">
            <button onclick="exportData()" class="btn btn-backup">üíæ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶®‡¶ø‡¶®</button>
            <div style="flex:1;"><input type="file" id="importFile" accept=".json" onchange="importData(this)" style="padding:8px;"></div>
            <button onclick="deleteAllData()" class="btn" style="background: #d32f2f;">üî• ‡¶∏‡¶ï‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
            <button onclick="saveSettings()" class="btn btn-save" style="width:auto;">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button onclick="closeSettings()" class="btn btn-delete">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Fee Collection Tab -->
    <div id="feeTab" class="tab-content active">
        <div class="input-box no-print">
            <div><label>üìã ‡¶∞‡ßã‡¶≤:</label><input type="number" id="rollInput" oninput="findStudent()" placeholder="‡¶∞‡ßã‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞"></div>
            <div><label>üìö ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø:</label><select id="classSelect" onchange="findStudent()"><option value="One">One</option><option value="Two">Two</option><option value="Three">Three</option><option value="Four">Four</option><option value="Five">Five</option><option value="Six">Six</option><option value="Seven">Seven</option><option value="Eight">Eight</option><option value="Nine">Nine</option><option value="Ten">Ten</option><option value="Eleven">Eleven</option><option value="Twelve">Twelve</option></select></div>
            <div><label>üìå ‡¶∂‡¶æ‡¶ñ‡¶æ:</label><select id="sectionSelect"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="N/A">N/A</option></select></div>
            <div><label>üî¨ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó:</label><select id="groupSelect"><option value="General">General</option><option value="Science">Science</option><option value="Commerce">Commerce</option><option value="Humanities">Humanities</option></select></div>
            <div style="grid-column: span 2;"><label>üë§ ‡¶®‡¶æ‡¶Æ:</label><div id="studentNameDisplay">‡¶∞‡ßã‡¶≤ ‡¶ì ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶¶‡¶ø‡¶®...</div></div>
            <div><label>üìÖ ‡¶∏‡ßá‡¶∂‡¶®:</label><input type="text" id="sessionInput" placeholder="‡ß®‡ß¶‡ß®‡ß™-‡ß®‡ß´"></div>
            <div><label>üóìÔ∏è ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="entryDate"></div>
            <div class="full-row year-month-box">
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px; flex-wrap: wrap;">
                    <div><label>üìÖ ‡¶¨‡¶õ‡¶∞:</label><input type="number" id="targetYear" style="width: 100px;" value="2026"></div>
                    <button onclick="addSelectedMonths()" class="btn" style="background: #1a73e8;">+ ‡¶Æ‡¶æ‡¶∏ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <span id="addedMonthsDisplay" style="font-weight:bold; color:#1a73e8; background:#e3f2fd; padding:5px 15px; border-radius:20px;">‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ</span>
                </div>
                <div class="month-grid">
                    <label class="month-item"><input type="checkbox" name="months" value="‡¶ú‡¶æ‡¶®‡ßÅ"> ‡¶ú‡¶æ‡¶®‡ßÅ</label><label class="month-item"><input type="checkbox" name="months" value="‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ"> ‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ</label><label class="month-item"><input type="checkbox" name="months" value="‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö"> ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö</label><label class="month-item"><input type="checkbox" name="months" value="‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤"> ‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤</label><label class="month-item"><input type="checkbox" name="months" value="‡¶Æ‡ßá"> ‡¶Æ‡ßá</label><label class="month-item"><input type="checkbox" name="months" value="‡¶ú‡ßÅ‡¶®"> ‡¶ú‡ßÅ‡¶®</label><label class="month-item"><input type="checkbox" name="months" value="‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á"> ‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á</label><label class="month-item"><input type="checkbox" name="months" value="‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü"> ‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü</label><label class="month-item"><input type="checkbox" name="months" value="‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá"> ‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá</label><label class="month-item"><input type="checkbox" name="months" value="‡¶Ö‡¶ï‡ßç‡¶ü‡ßã"> ‡¶Ö‡¶ï‡ßç‡¶ü‡ßã</label><label class="month-item"><input type="checkbox" name="months" value="‡¶®‡¶≠‡ßá"> ‡¶®‡¶≠‡ßá</label><label class="month-item"><input type="checkbox" name="months" value="‡¶°‡¶ø‡¶∏‡ßá"> ‡¶°‡¶ø‡¶∏‡ßá</label>
                </div>
            </div>
            <div class="fee-selection">
                <div><label>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶´‡¶ø</label><input type="number" id="valM" placeholder="0"><label style="display:flex; align-items:center; gap:5px; margin-top:5px;"><input type="checkbox" id="checkM"> ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</label></div>
                <div><label>‡¶∏‡ßá‡¶∂‡¶® ‡¶´‡¶ø</label><input type="number" id="valS" placeholder="0"><label style="display:flex; align-items:center; gap:5px; margin-top:5px;"><input type="checkbox" id="checkS"> ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</label></div>
                <div><label>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶´‡¶ø</label><input type="number" id="valE" placeholder="0"><label style="display:flex; align-items:center; gap:5px; margin-top:5px;"><input type="checkbox" id="checkE"> ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</label></div>
                <div><label>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</label><input type="number" id="valO" placeholder="0"><label style="display:flex; align-items:center; gap:5px; margin-top:5px;"><input type="checkbox" id="checkO"> ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§</label></div>
                <div><label>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</label><input type="number" id="valDue" style="color:red; border-color:#ff9800;" placeholder="0"></div>
            </div>
            <div class="full-row"><button id="saveBtn" onclick="saveData()" class="btn btn-save">üí∞ ‡¶´‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
        </div>
        <div class="search-panel no-print">
            <div style="grid-column: span 2;"><label>üîç ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®:</label><input type="text" id="searchIndi" placeholder="‡¶®‡¶æ‡¶Æ/‡¶∞‡ßã‡¶≤..." onkeyup="updateTable()"></div>
            <div><label>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø:</label><select id="searchCls" onchange="updateTable()"><option value="">‡¶∏‡¶¨ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option><option value="One">One</option><option value="Two">Two</option><option value="Three">Three</option><option value="Four">Four</option><option value="Five">Five</option><option value="Six">Six</option><option value="Seven">Seven</option><option value="Eight">Eight</option><option value="Nine">Nine</option><option value="Ten">Ten</option><option value="Eleven">Eleven</option><option value="Twelve">Twelve</option></select></div>
            <div><label>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó:</label><select id="searchGroup" onchange="updateTable()"><option value="">‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</option><option value="General">General</option><option value="Science">Science</option><option value="Commerce">Commerce</option><option value="Humanities">Humanities</option></select></div>
            <div><label>‡¶∏‡ßá‡¶∂‡¶®:</label><input type="text" id="searchSes" placeholder="‡ß®‡ß¶‡ß®‡ß™-‡ß®‡ß´" onkeyup="updateTable()"></div>
            <div><label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="searchSDate" onchange="updateTable()"></div>
            <div><label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="searchEDate" onchange="updateTable()"></div>
            <div style="grid-column: span 2;"><button onclick="printFullReport()" class="btn" style="background:#5c6bc0; width:100%;">üìä ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button></div>
        </div>
        <div class="table-container">
            <table id="feeTable"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶∞‡ßã‡¶≤</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</th><th>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</th><th>‡¶Æ‡¶æ‡¶∏</th><th>‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º (‡ß≥)</th><th>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ (‡ß≥)</th><th class="no-print">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="tableBody"></tbody><tfoot><tr class="total-row"><td colspan="6">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü:</td><td id="grandTotal">0</td><td id="grandDue">0</td><td class="no-print"></td></tr></tfoot></table>
        </div>
    </div>

    <!-- Income & Expense Tab -->
    <div id="accountsTab" class="tab-content">
        <div class="summary-cards">
            <div class="card card-income"><p>üìà ‡¶Æ‡ßã‡¶ü ‡¶Ü‡ßü</p><h2 id="totalIncomeDisplay">‡ß≥0</h2></div>
            <div class="card card-expense"><p>üìâ ‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö</p><h2 id="totalExpenseDisplay">‡ß≥0</h2></div>
            <div class="card card-balance"><p>üí∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><h2 id="totalBalanceDisplay">‡ß≥0</h2></div>
        </div>
        <div class="ie-form no-print">
            <div><label>üóìÔ∏è ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="ieDate"></div>
            <div><label>üìã ‡¶ß‡¶∞‡¶®:</label><select id="ieType" onchange="updateIECategory()"><option value="Income">‚ûï ‡¶Ü‡ßü (Income)</option><option value="Expense">‚ûñ ‡¶ñ‡¶∞‡¶ö (Expense)</option></select></div>
            <div><label>üè∑Ô∏è ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</label><select id="ieCategory"></select></div>
            <div><label>üí∞ ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</label><input type="number" id="ieAmount" placeholder="0"></div>
            <div><label>üìù ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</label><input type="text" id="ieDesc" placeholder="‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></div>
            <div style="grid-column: 1 / -1;"><button onclick="saveIEData()" class="btn" style="background:#2e7d32; width:200px; margin:0 auto;">‚ûï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button></div>
        </div>
        <div class="search-panel no-print" style="grid-template-columns: repeat(3, 1fr);">
            <div><label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="ieSearchSDate" onchange="updateIETable()"></div>
            <div><label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</label><input type="date" id="ieSearchEDate" onchange="updateIETable()"></div>
            <div><label>‡¶ß‡¶∞‡¶®:</label><select id="ieSearchType" onchange="updateIETable()"><option value="">‡¶∏‡¶¨</option><option value="Income">‡¶Ü‡ßü</option><option value="Expense">‡¶ñ‡¶∞‡¶ö</option></select></div>
        </div>
        <div class="table-container"><table id="ieTable"><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ß‡¶∞‡¶®</th><th>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶ü‡¶æ‡¶ï‡¶æ (‡ß≥)</th><th class="no-print">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead><tbody id="ieTableBody"></tbody></table></div>
    </div>
</div>

<script>
    // ==================== GLOBAL VARIABLES ====================
    let students = []; let finalMonthsList = []; let tempLogoBase64 = ""; let currentEditId = null; let editingStudentIndex = null;
    let schoolSettings = { name: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®", addr: "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ", mob: "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤", pass: "1234", logo: "" };
    let feeHistory = []; let ieHistory = [];

    function getSchoolId() {
        const urlParams = new URLSearchParams(window.location.search); let schoolId = urlParams.get('id');
        if (!schoolId) { schoolId = 'demo_school'; const url = new URL(window.location); url.searchParams.set('id', schoolId); window.history.replaceState({}, '', url); }
        return schoolId;
    }
    const SCHOOL_ID = getSchoolId();

    // ==================== STORAGE MANAGER ====================
    const StorageManager = {
        save: function(key, data) { try { localStorage.setItem(`${key}_${SCHOOL_ID}`, JSON.stringify(data)); this.updateStatus(true); return true; } catch (error) { this.updateStatus(false); showNotification("‚ùå ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!", "error"); return false; } },
        load: function(key) { try { const data = localStorage.getItem(`${key}_${SCHOOL_ID}`); return data ? JSON.parse(data) : null; } catch (error) { return null; } },
        remove: function(key) { try { localStorage.removeItem(`${key}_${SCHOOL_ID}`); return true; } catch (error) { return false; } },
        updateStatus: function(isConnected) { const statusEl = document.getElementById('storageStatus'); const textEl = document.getElementById('statusText'); if (isConnected) { statusEl.classList.remove('error'); textEl.innerText = "‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ (Local)"; } else { statusEl.classList.add('error'); textEl.innerText = "‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®!"; } }
    };

    function showNotification(message, type = 'success') { const notification = document.getElementById('notification'); notification.textContent = message; notification.className = `notification ${type}`; notification.style.display = 'block'; setTimeout(() => { notification.style.display = 'none'; }, 3000); }

    // ==================== PASSWORD CHECK ====================
    function checkPassword() {
        const enteredPass = document.getElementById('passwordInput').value; const errorDiv = document.getElementById('passwordError');
        const savedSettings = StorageManager.load('appConfig'); if (savedSettings) schoolSettings = savedSettings;
        if (enteredPass === schoolSettings.pass || enteredPass === "1234") { document.getElementById('passwordOverlay').style.display = 'none'; document.querySelector('.container').style.display = 'block'; initializeApp(); }
        else { errorDiv.style.display = 'block'; document.getElementById('passwordInput').value = ''; document.getElementById('passwordInput').focus(); }
    }
    document.addEventListener('DOMContentLoaded', function() { document.getElementById('passwordInput').addEventListener('keypress', function(e) { if (e.key === 'Enter') checkPassword(); }); document.getElementById('schoolIdDisplay').innerText = SCHOOL_ID; });

    function formatDate(dateStr) { if (!dateStr) return ""; const parts = dateStr.split('-'); return parts.length === 3 ? `${parts[2]}/${parts[1]}/${parts[0]}` : dateStr; }
    function switchTab(tabId) { document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active')); document.getElementById(tabId).classList.add('active'); if(tabId === 'feeTab') { document.querySelectorAll('.tab-btn')[0].classList.add('active'); } else { document.querySelectorAll('.tab-btn')[1].classList.add('active'); updateIETable(); calculateTotals(); } }

    // ==================== SETTINGS & STUDENT FUNCTIONS ====================
    function loadSettings() { const saved = StorageManager.load('appConfig'); if (saved) schoolSettings = saved; updateHeaderUI(); if (document.getElementById('setSchoolName')) document.getElementById('setSchoolName').value = schoolSettings.name || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®"; if (document.getElementById('setSchoolAddr')) document.getElementById('setSchoolAddr').value = schoolSettings.addr || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"; if (document.getElementById('setSchoolMob')) document.getElementById('setSchoolMob').value = schoolSettings.mob || "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤"; return schoolSettings; }
    function updateHeaderUI() { if (!schoolSettings) return; document.getElementById('headerName').innerText = schoolSettings.name || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®"; document.getElementById('headerAddress').innerText = (schoolSettings.addr || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ") + " | " + (schoolSettings.mob || "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤"); const schoolLogo = document.getElementById('schoolLogoImg'); if(schoolSettings.logo && schoolLogo) { schoolLogo.src = schoolSettings.logo; schoolLogo.style.display = "block"; } else if(schoolLogo) { schoolLogo.style.display = "none"; } }
    function previewLogo(input) { if (input.files && input.files[0]) { let reader = new FileReader(); reader.onload = (e) => { tempLogoBase64 = e.target.result; const schoolLogo = document.getElementById('schoolLogoImg'); schoolLogo.src = e.target.result; schoolLogo.style.display = "block"; }; reader.readAsDataURL(input.files[0]); } }
    function openSettings() { if(prompt("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®:") === schoolSettings.pass) { document.getElementById('settingsArea').style.display = "block"; } else { showNotification("‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!", "error"); } }
    function closeSettings() { document.getElementById('settingsArea').style.display = "none"; }
    function changePassword() { const oldPass = prompt("‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®:"); if (oldPass === schoolSettings.pass) { const newPass1 = prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®:"); if (newPass1) { const newPass2 = prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®:"); if (newPass1 === newPass2) { schoolSettings.pass = newPass1; StorageManager.save('appConfig', schoolSettings); showNotification("‚úÖ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá", "success"); } else { showNotification("‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Æ‡ßá‡¶≤‡ßá‡¶®‡¶ø", "error"); } } } else { showNotification("‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!", "error"); } }
    function saveSettings() { schoolSettings.name = document.getElementById('setSchoolName').value.trim() || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®"; schoolSettings.addr = document.getElementById('setSchoolAddr').value.trim() || "‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"; schoolSettings.mob = document.getElementById('setSchoolMob').value.trim() || "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤"; if(tempLogoBase64) schoolSettings.logo = tempLogoBase64; StorageManager.save('appConfig', schoolSettings); tempLogoBase64 = ""; updateHeaderUI(); showNotification("‚úÖ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success"); }
    function switchSchool() { const newSchoolId = prompt('‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®:'); if (newSchoolId) { const url = new URL(window.location); url.searchParams.set('id', newSchoolId); window.location.href = url; } }
    function loadStudentList() { students = StorageManager.load('students') || []; if (students.length === 0) { students = [{ name: "‡¶∞‡¶π‡¶ø‡¶Æ ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶", class: "One", roll: 101, section: "A", group: "General", session: "‡ß®‡ß¶‡ß®‡ß™" }, { name: "‡¶∏‡¶æ‡¶¨‡ßç‡¶¨‡¶ø‡¶∞ ‡¶π‡ßã‡¶∏‡ßá‡¶®", class: "One", roll: 102, section: "B", group: "General", session: "‡ß®‡ß¶‡ß®‡ß™" }]; StorageManager.save('students', students); } renderStudentPreview(); }
    function renderStudentPreview() { const tbody = document.getElementById('studentListPreviewBody'); if (!tbody) return; tbody.innerHTML = ""; students.forEach((s, index) => { tbody.innerHTML += `<tr><td>${s.name || ''}</td><td>${s.class || ''}</td><td>${s.roll || ''}</td><td>${s.section || 'N/A'}</td><td>${s.group || 'N/A'}</td><td>${s.session || 'N/A'}</td><td><button onclick="editStudentEntry(${index})" style="background:#ff9800; color:white; border:none; padding:3px 8px; border-radius:4px; cursor:pointer; margin-right:5px;">‚úé</button><button onclick="deleteStudentEntry(${index})" style="background:#dc3545; color:white; border:none; padding:3px 8px; border-radius:4px; cursor:pointer;">‚úï</button></td></tr>`; }); }
    function saveStudentData() { const name = document.getElementById('newStName').value.trim(); const cls = document.getElementById('newStClass').value.trim(); const roll = document.getElementById('newStRoll').value.trim(); const section = document.getElementById('newStSection').value.trim() || "N/A"; const group = document.getElementById('newStGroup').value.trim() || "General"; const session = document.getElementById('newStSession').value.trim() || "N/A"; if (!name || !cls || !roll) { showNotification("‡¶®‡¶æ‡¶Æ, ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶ì ‡¶∞‡ßã‡¶≤ ‡¶¶‡¶ø‡¶®‡•§", "error"); return; } if (editingStudentIndex !== null) { students[editingStudentIndex] = { name, class: cls, roll: parseInt(roll), section, group, session }; editingStudentIndex = null; document.getElementById('addStudentBtn').innerText = "‚ûï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®"; document.getElementById('studentFormBox').classList.remove('edit-mode'); showNotification("‚úÖ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); } else { const exists = students.find(s => s.class === cls && s.roll == roll); if (exists) { showNotification("‡¶è‡¶á ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶ì ‡¶∞‡ßã‡¶≤‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶Ü‡¶õ‡ßá‡¶®‡•§", "error"); return; } students.push({ name, class: cls, roll: parseInt(roll), section, group, session }); showNotification("‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); } StorageManager.save('students', students); renderStudentPreview(); clearStudentForm(); }
    function clearStudentForm() { document.getElementById('newStName').value = ''; document.getElementById('newStClass').value = ''; document.getElementById('newStRoll').value = ''; document.getElementById('newStSection').value = ''; document.getElementById('newStGroup').value = ''; document.getElementById('newStSession').value = ''; }
    function editStudentEntry(index) { const s = students[index]; document.getElementById('newStName').value = s.name || ''; document.getElementById('newStClass').value = s.class || ''; document.getElementById('newStRoll').value = s.roll || ''; document.getElementById('newStSection').value = s.section || ''; document.getElementById('newStGroup').value = s.group || ''; document.getElementById('newStSession').value = s.session || ''; editingStudentIndex = index; document.getElementById('addStudentBtn').innerText = "üîÑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®"; document.getElementById('studentFormBox').classList.add('edit-mode'); }
    function deleteStudentEntry(index) { if(confirm("‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) { students.splice(index, 1); StorageManager.save('students', students); renderStudentPreview(); showNotification("‚úÖ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); } }
    function uploadStudentCSV() { const fileInput = document.getElementById('csvStudentFile'); const file = fileInput.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = function(e) { const lines = e.target.result.split('\n'); let count = 0; for (let i = 1; i < lines.length; i++) { const p = lines[i].split(','); if (p.length >= 3 && p[0].trim() && p[1].trim() && p[2].trim()) { if (!students.find(s => s.class === p[1].trim() && s.roll == p[2].trim())) { students.push({ name: p[0].trim(), class: p[1].trim(), roll: parseInt(p[2].trim()), section: p[3]?p[3].trim():"N/A", group: p[4]?p[4].trim():"General", session: p[5]?p[5].trim():"N/A" }); count++; } } } StorageManager.save('students', students); renderStudentPreview(); showNotification(`${count} ‡¶ú‡¶® ‡¶®‡¶§‡ßÅ‡¶® ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá`, "success"); fileInput.value = ''; }; reader.readAsText(file); }

    // ==================== FEE COLLECTION ====================
    function findStudent() { const roll = document.getElementById('rollInput').value; const sClass = document.getElementById('classSelect').value; const student = students.find(s => s.roll == roll && s.class == sClass); const nameDisplay = document.getElementById('studentNameDisplay'); if (student) { nameDisplay.innerText = `${student.name} (‡¶∞‡ßã‡¶≤: ${student.roll})`; if(student.section) document.getElementById('sectionSelect').value = student.section; if(student.group) document.getElementById('groupSelect').value = student.group; if(student.session) document.getElementById('sessionInput').value = student.session; } else { nameDisplay.innerText = "‚ö†Ô∏è ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!"; } }
    function addSelectedMonths() { let year = document.getElementById('targetYear').value; document.querySelectorAll('input[name="months"]:checked').forEach(cb => { let entry = cb.value + "-" + year; if(!finalMonthsList.includes(entry)) finalMonthsList.push(entry); cb.checked = false; }); document.getElementById('addedMonthsDisplay').innerText = finalMonthsList.join(", "); }
    function saveData() { let paid = 0, detailsArr = []; if(document.getElementById('checkM').checked) { paid += parseFloat(document.getElementById('valM').value)||0; detailsArr.push("‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï:" + (parseFloat(document.getElementById('valM').value)||0)); } if(document.getElementById('checkS').checked) { paid += parseFloat(document.getElementById('valS').value)||0; detailsArr.push("‡¶∏‡ßá‡¶∂‡¶®:" + (parseFloat(document.getElementById('valS').value)||0)); } if(document.getElementById('checkE').checked) { paid += parseFloat(document.getElementById('valE').value)||0; detailsArr.push("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ:" + (parseFloat(document.getElementById('valE').value)||0)); } if(document.getElementById('checkO').checked) { paid += parseFloat(document.getElementById('valO').value)||0; detailsArr.push("‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø:" + (parseFloat(document.getElementById('valO').value)||0)); } let entryData = { id: currentEditId || Date.now(), date: document.getElementById('entryDate').value || new Date().toISOString().split('T')[0], session: document.getElementById('sessionInput').value, student: document.getElementById('studentNameDisplay').innerText, class: document.getElementById('classSelect').value, roll: parseInt(document.getElementById('rollInput').value) || 0, section: document.getElementById('sectionSelect').value, group: document.getElementById('groupSelect').value, months: finalMonthsList.join(", "), paid, due: parseFloat(document.getElementById('valDue').value) || 0, details: detailsArr.length > 0 ? detailsArr.join(", ") : "‡¶®‡¶ó‡¶¶ ‡¶ó‡ßç‡¶∞‡¶π‡¶£", schoolId: SCHOOL_ID }; feeHistory = StorageManager.load('fees') || []; const existingIndex = feeHistory.findIndex(f => f.id == entryData.id); if (existingIndex >= 0) feeHistory[existingIndex] = entryData; else feeHistory.push(entryData); StorageManager.save('fees', feeHistory); ieHistory = StorageManager.load('accounts') || []; const ieIndex = ieHistory.findIndex(ie => ie.refId == entryData.id); const ieEntry = { id: ieIndex >= 0 ? ieHistory[ieIndex].id : Date.now(), refId: entryData.id, date: entryData.date, type: "Income", category: "‡¶´‡¶ø ‡¶Ü‡¶¶‡¶æ‡ßü", amount: entryData.paid, description: `${entryData.student} - ${entryData.months}`, schoolId: SCHOOL_ID }; if (ieIndex >= 0) ieHistory[ieIndex] = ieEntry; else ieHistory.push(ieEntry); StorageManager.save('accounts', ieHistory); showNotification(currentEditId ? "‚úÖ ‡¶´‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!" : "‚úÖ ‡¶´‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "success"); clearForm(); updateTable(); calculateTotals(); }
    function clearForm() { document.getElementById('rollInput').value = ''; document.getElementById('studentNameDisplay').innerText = '‡¶∞‡ßã‡¶≤ ‡¶ì ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶¶‡¶ø‡¶®...'; ['valM', 'valS', 'valE', 'valO', 'valDue'].forEach(id => document.getElementById(id).value = ''); ['checkM', 'checkS', 'checkE', 'checkO'].forEach(id => document.getElementById(id).checked = false); finalMonthsList = []; document.getElementById('addedMonthsDisplay').innerText = "‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶®‡¶æ"; currentEditId = null; document.getElementById('saveBtn').innerText = "üí∞ ‡¶´‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®"; }
    function updateTable() { feeHistory = StorageManager.load('fees') || []; let kIndi = document.getElementById('searchIndi').value.toUpperCase(); let kCls = document.getElementById('searchCls').value; let kGrp = document.getElementById('searchGroup').value; let kSes = document.getElementById('searchSes').value; let sDate = document.getElementById('searchSDate').value, eDate = document.getElementById('searchEDate').value; let tableBody = document.getElementById('tableBody'); let tPaid = 0, tDue = 0; tableBody.innerHTML = ""; feeHistory.forEach(item => { const match = (!kIndi || (item.student && item.student.toUpperCase().includes(kIndi)) || (item.roll && item.roll.toString().includes(kIndi))) && (!kCls || item.class === kCls) && (!kGrp || item.group === kGrp) && (!kSes || (item.session && item.session.includes(kSes))) && ((!sDate || !eDate) || (item.date >= sDate && item.date <= eDate)); if(match) { tPaid += item.paid; tDue += item.due; tableBody.innerHTML += `<tr><td>${formatDate(item.date)}</td><td>${item.student}</td><td>${item.class}</td><td>${item.group}</td><td>${item.months}</td><td>${item.details}</td><td>‡ß≥${item.paid}</td><td>‡ß≥${item.due}</td><td class="no-print"><button onclick="editItem('${item.id}')" class="btn btn-edit" style="padding:5px 10px;">‚úé</button><button onclick="printReceipt('${item.id}')" class="btn btn-print" style="padding:5px 10px;">üñ®Ô∏è</button><button onclick="deleteItem('${item.id}')" class="btn btn-delete" style="padding:5px 10px;">‚úï</button></td></tr>`; } }); document.getElementById('grandTotal').innerText = '‡ß≥' + tPaid; document.getElementById('grandDue').innerText = '‡ß≥' + tDue; }
    function editItem(id) { feeHistory = StorageManager.load('fees') || []; let item = feeHistory.find(i => i.id == id); if (item) { currentEditId = id; document.getElementById('entryDate').value = item.date; document.getElementById('sessionInput').value = item.session; document.getElementById('classSelect').value = item.class; document.getElementById('rollInput').value = item.roll || ''; document.getElementById('studentNameDisplay').innerText = item.student; document.getElementById('sectionSelect').value = item.section; document.getElementById('groupSelect').value = item.group; finalMonthsList = item.months ? item.months.split(', ').filter(m => m.trim() !== '') : []; document.getElementById('addedMonthsDisplay').innerText = item.months; document.getElementById('valDue').value = item.due; ['checkM', 'checkS', 'checkE', 'checkO'].forEach(id => document.getElementById(id).checked = false); ['valM', 'valS', 'valE', 'valO'].forEach(id => document.getElementById(id).value = ''); if(item.details) { item.details.split(', ').forEach(p => { if(p.includes("‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï:")) { document.getElementById('checkM').checked = true; document.getElementById('valM').value = p.split(':')[1]; } if(p.includes("‡¶∏‡ßá‡¶∂‡¶®:")) { document.getElementById('checkS').checked = true; document.getElementById('valS').value = p.split(':')[1]; } if(p.includes("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ:")) { document.getElementById('checkE').checked = true; document.getElementById('valE').value = p.split(':')[1]; } if(p.includes("‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø:")) { document.getElementById('checkO').checked = true; document.getElementById('valO').value = p.split(':')[1]; } }); } document.getElementById('saveBtn').innerText = "üîÑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®"; window.scrollTo({ top: 0, behavior: 'smooth' }); } }
    function deleteItem(id) { if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) { feeHistory = StorageManager.load('fees') || []; feeHistory = feeHistory.filter(f => f.id != id); StorageManager.save('fees', feeHistory); ieHistory = StorageManager.load('accounts') || []; ieHistory = ieHistory.filter(ie => ie.refId != id); StorageManager.save('accounts', ieHistory); updateTable(); calculateTotals(); showNotification("‚úÖ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); } }

    // ==================== INCOME/EXPENSE ====================
    function updateIECategory() { const type = document.getElementById('ieType').value; const catSelect = document.getElementById('ieCategory'); catSelect.innerHTML = ""; const options = type === 'Income' ? ['‡¶´‡¶ø ‡¶Ü‡¶¶‡¶æ‡ßü', '‡¶¶‡¶æ‡¶®/‡¶Ö‡¶®‡ßÅ‡¶¶‡¶æ‡¶®', '‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶¶‡¶æ‡¶®', '‡¶≠‡¶∞‡ßç‡¶§‡¶ø ‡¶´‡¶ø', '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Ü‡ßü'] : ['‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶¨‡ßá‡¶§‡¶®', '‡¶∏‡ßç‡¶ü‡¶æ‡¶´ ‡¶¨‡ßá‡¶§‡¶®', '‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤', '‡¶™‡¶æ‡¶®‡¶ø ‡¶¨‡¶ø‡¶≤', '‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶¨‡¶ø‡¶≤', '‡¶Ö‡¶´‡¶ø‡¶∏ ‡¶ñ‡¶∞‡¶ö', '‡¶Æ‡ßá‡¶∞‡¶æ‡¶Æ‡¶§', '‡¶™‡¶∞‡¶ø‡¶¨‡¶π‡¶®', '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ñ‡¶∞‡¶ö']; options.forEach(opt => catSelect.innerHTML += `<option value="${opt}">${opt}</option>`); }
    function saveIEData() { const amount = parseFloat(document.getElementById('ieAmount').value) || 0; if(amount <= 0) { showNotification("‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®", "error"); return; } const entry = { id: Date.now(), date: document.getElementById('ieDate').value || new Date().toISOString().split('T')[0], type: document.getElementById('ieType').value, category: document.getElementById('ieCategory').value, amount, description: document.getElementById('ieDesc').value || (type === 'Income' ? '‡¶Ü‡ßü' : '‡¶ñ‡¶∞‡¶ö'), schoolId: SCHOOL_ID }; ieHistory = StorageManager.load('accounts') || []; ieHistory.push(entry); StorageManager.save('accounts', ieHistory); document.getElementById('ieAmount').value = ""; document.getElementById('ieDesc').value = ""; updateIETable(); calculateTotals(); showNotification("‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); }
    function updateIETable() { ieHistory = StorageManager.load('accounts') || []; let sDate = document.getElementById('ieSearchSDate').value; let eDate = document.getElementById('ieSearchEDate').value; let sType = document.getElementById('ieSearchType').value; let tbody = document.getElementById('ieTableBody'); tbody.innerHTML = ""; ieHistory.forEach(item => { if((!sDate || !eDate || (item.date >= sDate && item.date <= eDate)) && (!sType || item.type === sType)) { const color = item.type === 'Income' ? '#2e7d32' : '#c62828'; tbody.innerHTML += `<tr><td>${formatDate(item.date)}</td><td style="color:${color}; font-weight:bold">${item.type === 'Income' ? '‡¶Ü‡ßü' : '‡¶ñ‡¶∞‡¶ö'}</td><td>${item.category}</td><td>${item.description}</td><td style="color:${color}; font-weight:bold">${item.type === 'Income' ? '+' : '-'} ‡ß≥${item.amount}</td><td class="no-print">${!item.refId ? `<button onclick="deleteIEItem('${item.id}')" class="btn btn-delete" style="padding:5px 10px;">‚úï</button>` : '<span style="color:#999; font-size:12px;">‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span>'}</td></tr>`; } }); }
    function deleteIEItem(id) { if(confirm("‡¶è‡¶á ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) { ieHistory = StorageManager.load('accounts') || []; ieHistory = ieHistory.filter(a => a.id != id); StorageManager.save('accounts', ieHistory); updateIETable(); calculateTotals(); showNotification("‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); } }
    function calculateTotals() { ieHistory = StorageManager.load('accounts') || []; let totalIn = 0, totalEx = 0; ieHistory.forEach(item => { if(item.type === 'Income') totalIn += item.amount; else totalEx += item.amount; }); document.getElementById('totalIncomeDisplay').innerText = '‡ß≥' + totalIn; document.getElementById('totalExpenseDisplay').innerText = '‡ß≥' + totalEx; document.getElementById('totalBalanceDisplay').innerText = '‡ß≥' + (totalIn - totalEx); }

    // ==================== PRINT FUNCTIONS (FIXED FOOTER) ====================
    function printReceipt(id) {
        feeHistory = StorageManager.load('fees') || [];
        let item = feeHistory.find(i => i.id == id);
        if(!item) return;

        let win = window.open('', '', 'height=700,width=900'); 
        win.document.write(`
            <html>
            <head>
                <title>‡¶∞‡¶∏‡¶ø‡¶¶ - A4</title>
                <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
                <style>
                    @page { size: A4; margin: 0; }
                    body { margin: 0; padding: 0; font-family: 'Hind Siliguri', Arial, sans-serif; background: white; }
                    
                    /* Main Page Container */
                    .page-wrapper {
                        width: 210mm;
                        height: 297mm;
                        background: white;
                        padding: 12mm; /* Safe margin inside paper edge */
                        box-sizing: border-box;
                    }

                    /* Border Box */
                    .border-container {
                        width: 100%;
                        height: 100%;
                        border: 12px double #1a73e8;
                        border-radius: 5px;
                        box-sizing: border-box;
                        padding: 40px;
                        
                        /* Flexbox for vertical spacing */
                        display: flex;
                        flex-direction: column;
                    }

                    /* Header */
                    .header { text-align: center; border-bottom: 4px solid #1a73e8; padding-bottom: 20px; margin-bottom: 25px; }
                    .header img { width: 110px; height: 110px; border-radius: 50%; border: 3px solid #1a73e8; object-fit: cover; margin-bottom: 10px; }
                    .header h1 { color: #1a73e8; font-size: 42px; margin: 0; line-height: 1.2; }
                    .header p { font-size: 18px; color: #555; margin-top: 5px; }

                    /* Title */
                    .title { text-align: center; background: #1a73e8; color: white; padding: 10px 20px; font-size: 28px; border-radius: 50px; font-weight: bold; margin: 0 auto 30px; width: 80%; }

                    /* Content Body */
                    .content-body {
                        flex-grow: 1; /* Takes all available space between header and footer */
                    }

                    /* Info Grid */
                    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
                    .info-item { font-size: 20px; padding: 6px 0; border-bottom: 2px dashed #ccc; display: flex; justify-content: space-between; }
                    .info-item b { color: #1a73e8; text-align: right; }

                    /* Details */
                    .details-box { background: #f0f7ff; border: 2px solid #1a73e8; padding: 20px; border-radius: 8px; margin: 15px 0; font-size: 20px; text-align: center; }

                    /* Amount Box */
                    .amount-box { 
                        display: flex; 
                        justify-content: space-between; 
                        background: #e3f2fd; 
                        border: 3px solid #1a73e8; 
                        padding: 20px; 
                        border-radius: 12px; 
                        font-size: 28px; 
                        font-weight: bold; 
                        margin-top: 20px;
                        margin-bottom: 40px; /* Space between amount and signature */
                    }
                    .amount-box .due { color: #c62828; }

                    /* Footer */
                    .footer { 
                        display: flex; 
                        justify-content: space-between; 
                        padding-top: 20px;
                        /* No absolute positioning */
                    }
                    .sign { width: 180px; text-align: center; border-top: 3px solid #333; padding-top: 8px; font-size: 18px; font-weight: bold; }
                    
                    @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
                </style>
            </head>
            <body>
                <div class="page-wrapper">
                    <div class="border-container">
                        <div class="header">
                            ${schoolSettings.logo ? `<img src="${schoolSettings.logo}">` : ''}
                            <h1>${schoolSettings.name}</h1>
                            <p>${schoolSettings.addr} | üìû ${schoolSettings.mob}</p>
                        </div>
                        
                        <div class="title">üßæ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡ßá‡¶∞ ‡¶∞‡¶∏‡¶ø‡¶¶</div>
                        
                        <div class="content-body">
                            <div class="info-grid">
                                <div class="info-item"><span>‡¶®‡¶æ‡¶Æ:</span> <b>${item.student}</b></div>
                                <div class="info-item"><span>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span> <b>${formatDate(item.date)}</b></div>
                                <div class="info-item"><span>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø:</span> <b>${item.class} | ‡¶∂‡¶æ‡¶ñ‡¶æ: ${item.section}</b></div>
                                <div class="info-item"><span>‡¶∞‡ßã‡¶≤:</span> <b>${item.roll}</b></div>
                                <div class="info-item"><span>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó:</span> <b>${item.group}</b></div>
                                <div class="info-item"><span>‡¶∏‡ßá‡¶∂‡¶®:</span> <b>${item.session || 'N/A'}</b></div>
                            </div>
                            
                            <div class="details-box">
                                üìÜ ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ ‡¶Æ‡¶æ‡¶∏: <b>${item.months}</b><br><br>
                                üìù ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£: ${item.details}
                            </div>
                            
                            <div class="amount-box">
                                <span>üíµ ‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º: ‡ß≥ ${item.paid}/-</span>
                                <span class="due">‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ: ‡ß≥ ${item.due}/-</span>
                            </div>
                        </div>
                        
                        <div class="footer">
                            <div class="sign">‡¶ï‡¶Æ‡¶ø‡¶ü‡¶ø‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                            <div class="sign">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                        </div>
                    </div>
                </div>
            </body>
            </html>
        `);
        win.document.close();
        setTimeout(() => { win.print(); }, 500);
    }

    function printFullReport() { feeHistory = StorageManager.load('fees') || []; let tableRows = ""; let tPaid=0, tDue=0; feeHistory.forEach(item => { tPaid += item.paid; tDue += item.due; tableRows += `<tr><td>${formatDate(item.date)}</td><td>${item.student}</td><td>${item.class}</td><td>${item.months}</td><td>${item.details}</td><td>${item.paid}</td><td>${item.due}</td></tr>`; }); let win = window.open('', '', 'height=800,width=1200'); win.document.write(`<html><head><style>body{font-family:Arial,sans-serif;padding:30px;} table{width:100%;border-collapse:collapse;} th,td{border:1px solid #ddd;padding:8px;text-align:center;} th{background:#1a73e8;color:white;}</style></head><body><h1 style="text-align:center">${schoolSettings.name} - ‡¶´‡¶ø ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h1><table><thead><tr><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</th><th>‡¶Æ‡¶æ‡¶∏</th><th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th><th>‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º</th><th>‡¶¨‡¶ï‡ßá‡¶Ø‡¶º‡¶æ</th></tr></thead><tbody>${tableRows}</tbody><tfoot><tr style="background:#333;color:#ffeb3b;font-weight:bold;"><td colspan="5">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü:</td><td>‡ß≥${tPaid}</td><td>‡ß≥${tDue}</td></tr></tfoot></table></body></html>`); win.document.close(); setTimeout(() => win.print(), 500); }

    // ==================== BACKUP FUNCTIONS ====================
    function exportData() { const data = { config: schoolSettings, students: students, fees: StorageManager.load('fees'), accounts: StorageManager.load('accounts'), schoolId: SCHOOL_ID, exportDate: new Date().toISOString() }; const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Backup_${SCHOOL_ID}_${new Date().toISOString().split('T')[0]}.json`; a.click(); showNotification("‚úÖ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá", "success"); }
    function importData(input) { if (input.files && input.files[0]) { let reader = new FileReader(); reader.onload = function(e) { try { let data = JSON.parse(e.target.result); if(data.config) StorageManager.save('appConfig', data.config); if(data.students) StorageManager.save('students', data.students); if(data.fees) StorageManager.save('fees', data.fees); if(data.accounts) StorageManager.save('accounts', data.accounts); showNotification("‚úÖ ‡¶á‡¶Æ‡ßç‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...", "success"); setTimeout(() => location.reload(), 1500); } catch(e) { showNotification("‚ùå ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü", "error"); } }; reader.readAsText(input.files[0]); } }
    function deleteAllData() { if(prompt("‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá 'DELETE' ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®:") === 'DELETE') { StorageManager.remove('students'); StorageManager.remove('fees'); StorageManager.remove('accounts'); StorageManager.remove('appConfig'); showNotification("‚úÖ ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "success"); setTimeout(() => location.reload(), 1500); } }

    // ==================== INITIALIZATION ====================
    function initializeApp() { document.getElementById('schoolIdDisplay').innerText = SCHOOL_ID; const today = new Date().toISOString().split('T')[0]; document.getElementById('entryDate').value = today; document.getElementById('ieDate').value = today; loadStudentList(); loadSettings(); updateTable(); updateIETable(); calculateTotals(); updateIECategory(); }
</script>
</body>
</html>